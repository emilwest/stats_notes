<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Emil Westin">

<title>Survey_sampling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="_survey_sampling_files/libs/clipboard/clipboard.min.js"></script>
<script src="_survey_sampling_files/libs/quarto-html/quarto.js"></script>
<script src="_survey_sampling_files/libs/quarto-html/popper.min.js"></script>
<script src="_survey_sampling_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="_survey_sampling_files/libs/quarto-html/anchor.min.js"></script>
<link href="_survey_sampling_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="_survey_sampling_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="_survey_sampling_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="_survey_sampling_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="_survey_sampling_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Survey_sampling</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Emil Westin </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="survey-sampling" class="level1">
<h1>Survey sampling</h1>
<p>Survey sampling is a statistical process (statistisk undersökning) characterized by the following:</p>
<ul>
<li><p>A well-defined finite set of elements, a population. It must be clear which elements are a part of the population you wish to study.</p></li>
<li><p>The elements are measurable and there is a need for information about some population parameters.</p></li>
<li><p>A sampling frame (urvalsram) is needed, i.e.&nbsp;an operational representation of the elements. For example a hierarchy of sampling units that associate each element with a sampling unit.</p></li>
<li><p>A sample (stickprov) of elements is done by sampling sampling units from the sampling frame accoridning to some sample design (urvalsdesign), such that each element has a known positive probability of being selected. An exception being a total survey (totalundersökning) where all elements are selected.</p></li>
<li><p>The sampled elements are observed (measured) with regards to the set of variables that are of interest for the survey accordning to a measurement plan.</p></li>
<li><p>The collected observations are finally used to estimate population parameters (total, mean, percent, quotients, regression coefficients, …) where information is needed.</p></li>
</ul>
<section id="notation" class="level2">
<h2 class="anchored" data-anchor-id="notation">Notation</h2>
<p>Typically, the set notation is used in survey sampling. The variable (undersökningsvariabeln) is denoted as <span class="math inline">\(y\)</span> instead of the traditional <span class="math inline">\(x\)</span>.</p>
<p><span class="math inline">\(\bar{y} = \frac{1}{n}\sum_{i \in s}y_i, \text{ where }s= {1,2,...,n}\)</span></p>
<p>The population is</p>
<p><span class="math inline">\(U = {1,2,...,k,...,N}\)</span></p>
<p>Let <span class="math inline">\(y_k\)</span> denote the value of element <span class="math inline">\(k\)</span> in the population.</p>
<p>The parameter (målstorhet) <span class="math inline">\(t\)</span> (the total of <span class="math inline">\(y\)</span>) is very important.</p>
<p><span class="math inline">\(t = t_y = \sum_{k \in U} y_k = \sum_{U} y_k = y_1 + y_2 + ... + y_N\)</span></p>
<p>The mean is a function of the total:</p>
<p><span class="math inline">\(\bar{y}_U = \frac{\sum_U y_k}{N} = \frac{\sum_U y_k}{\sum_U 1} = \frac{\sum_U y_k}{\sum_U z_k} = \frac{t_y}{t_z}, \text{ where } z_k = 1\)</span></p>
<p>To estimate the parameters, a sample <span class="math inline">\(s\)</span> is drawn of size <span class="math inline">\(n\)</span> according to a sampling design <span class="math inline">\(p(s)\)</span>. In some sampling designs, <span class="math inline">\(N\)</span> is known and can be trated as a constant. In others, <span class="math inline">\(N\)</span> must be estimated.</p>
</section>
<section id="sampling-design" class="level2">
<h2 class="anchored" data-anchor-id="sampling-design">Sampling design</h2>
<section id="simple-random-sample-osu---obundet-slumpmässigt-urval" class="level3">
<h3 class="anchored" data-anchor-id="simple-random-sample-osu---obundet-slumpmässigt-urval">Simple random sample (OSU - obundet slumpmässigt urval)</h3>
<p>Without replacement. The definition of OSU is that each possible combination of samples drawn of (fixed) size <span class="math inline">\(n\)</span> from <span class="math inline">\(N\)</span> are equally likely (have the same probability of being drawn).</p>
<p><span class="math inline">\(p(s) = \frac{1}{\binom{N}{n}}\)</span></p>
<p>For example, consider the objects A, B, C, D, E (<span class="math inline">\(N=5\)</span>). If we select <span class="math inline">\(n=3\)</span> objects, this can be done in <span class="math inline">\(\binom{5}{3} = \frac{5!}{3!(5-3)!} = 10\)</span> different ways. The probability for each of the possible samples is <span class="math inline">\(p(s) = 1/10=0.1\)</span>. The sum of all <span class="math inline">\(p(s)=1\)</span> ie <span class="math inline">\(\sum_{\text{all s}} p(s) = 1\)</span>.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 7
      Nr A     B     C     D     E     `p(s)`
   &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;
 1     1 "A"   "B"   "C"   ""    ""       0.1
 2     2 "A"   "B"   ""    "D"   ""       0.1
 3     3 "A"   "B"   ""    ""    "E"      0.1
 4     4 "A"   ""    "C"   "D"   ""       0.1
 5     5 "A"   ""    "C"   ""    "E"      0.1
 6     6 "A"   ""    ""    "D"   "E"      0.1
 7     7 ""    "B"   "C"   "D"   ""       0.1
 8     8 ""    "B"   "C"   ""    "E"      0.1
 9     9 ""    "B"   ""    "D"   "E"      0.1
10    10 ""    ""    "C"   "D"   "E"      0.1</code></pre>
</div>
</div>
<p>Note for example that the probability of selecting A is <span class="math inline">\(n/N=6/10 = 0.6\)</span>. The same probability for B, C, D and E.</p>
<section id="first-order-inclusion-probability" class="level4">
<h4 class="anchored" data-anchor-id="first-order-inclusion-probability">First order inclusion probability</h4>
<p>Inklusionssannolikhet (första ordningens).</p>
<p>The probability of selecting element <span class="math inline">\(k\)</span> is</p>
<p><span class="math inline">\(P(k \in s) = \pi_k = \sum p(s)\)</span> for all <span class="math inline">\(s\)</span> where <span class="math inline">\(k\)</span> is inkluded.</p>
<p>In the example above for <span class="math inline">\(N=5,n=3\)</span>, <span class="math inline">\(\pi_k = n/N = 0.6\)</span> (for OSU).</p>
<p>This can be shown by asking: what is the probability of an event happening k times in n trials, without replacement? We can use the hypergeometric distribution.</p>
<p><span class="math inline">\(P(k \in s) = \frac{\binom{1}{1}\binom{N-1}{n-1}}{\binom{N}{n}} = \frac{\frac{(N-1)!}{(n-1)![N-1-(n-1)]!}}{\frac{N!}{n!(N-n)!}} = \frac{(N-1)!n!(N-n)!}{N!(n-1)!(N-n)!} = \frac{n}{N}\)</span></p>
<p>An indicator variable can be used to indicate if element k is included in the sample: <span class="math inline">\(I_k = 1\)</span> if <span class="math inline">\(k\in s\)</span> and <span class="math inline">\(I_k = 0\)</span> if <span class="math inline">\(k \notin s\)</span>. <span class="math inline">\(I_k\)</span> is a Bernoulli random variable.</p>
<p><span class="math inline">\(E(I_k) = P(I_k = 1)\times 1 + P(I_k = 0)\times 0 = P(I_k = 1) = \pi_k\)</span></p>
<p>Also note that:</p>
<p><span class="math inline">\(E(I_k^2) = P(I_k^2 = 1)\times 1 + P(I_k^2 = 0)\times 0 = P(I_k^2 = 1) = \pi_k\)</span></p>
<p>since <span class="math inline">\(I_k^2 = 1^2 = 1\)</span> if <span class="math inline">\(k\in s\)</span>.</p>
<p>The variance of the inclusion probability is</p>
<p><span class="math display">\[V(I_k) = E[I_k - E(I_k)]^2 = E[I_k^2] - [E(I_k)]^2 = E[I_k] - [E(I_k)]^2 \\
= \pi_k-\pi_k^2 = \pi_k(1-\pi_k)\]</span></p>
</section>
<section id="second-order-inclusion-probability" class="level4">
<h4 class="anchored" data-anchor-id="second-order-inclusion-probability">Second order inclusion probability</h4>
<p>The probability of selecting both element <span class="math inline">\(k\)</span> and <span class="math inline">\(l\)</span> is</p>
<p><span class="math inline">\(P(k \&amp; l \in s) = P(I_k I_l = 1) = \sum p(s)\)</span> for all s where k and l are included. Note that <span class="math inline">\(I_k I_l = 1\)</span> if and only if both k and l are in the sample.</p>
<p><span class="math inline">\(E(I_k I_l ) = P(I_k I_l = 1) = \pi_{kl}\)</span></p>
<p>which is</p>
<p><span class="math display">\[
\begin{align}
\pi_{kl} = P(k\&amp;l \in s) &amp;= \frac{\binom{2}{2}\binom{N-2}{n-2}}{\binom{N}{n}} \\
&amp;= \frac{\frac{(N-2)!}{(n-2)![N-2-(n-2)]!}}{\frac{N!}{n!(N-n)!}} \\
&amp;= \frac{(N-2)!n!(N-n)!}{N!(n-2)!(N-n)!} \\
&amp;=  \frac{n(n-1)}{N(N-1)}
\end{align}
\]</span></p>
<p>For example, from the example table we can visually see that selecting both A and B has a probability of 0.3 (<span class="math inline">\(\sum p(s) = 0.1+0.1+0.1\)</span>).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 7
      Nr A     B     C     D     E     `p(s)`
   &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;
 1     1 "A"   "B"   "C"   ""    ""       0.1
 2     2 "A"   "B"   ""    "D"   ""       0.1
 3     3 "A"   "B"   ""    ""    "E"      0.1
 4     4 "A"   ""    "C"   "D"   ""       0.1
 5     5 "A"   ""    "C"   ""    "E"      0.1
 6     6 "A"   ""    ""    "D"   "E"      0.1
 7     7 ""    "B"   "C"   "D"   ""       0.1
 8     8 ""    "B"   "C"   ""    "E"      0.1
 9     9 ""    "B"   ""    "D"   "E"      0.1
10    10 ""    ""    "C"   "D"   "E"      0.1</code></pre>
</div>
</div>
<p>which is shown to be equal to</p>
<p><span class="math inline">\(\pi_{kl} = \frac{3(2-1)}{5(5-1)} = \frac{6}{20} = \frac{3}{10} = 0.3\)</span></p>
</section>
</section>
</section>
<section id="horvitz-thompson-estimator" class="level2">
<h2 class="anchored" data-anchor-id="horvitz-thompson-estimator">Horvitz-Thompson Estimator</h2>
<p>The HT-estimator is a general unbiased estimator regardless of the sampling design.</p>
<p><span class="math inline">\(\hat{t} = \hat{t}_y = \hat{t}_{yHT} = \sum_{k \in s} \frac{y_k}{\pi_k} = \sum_{k \in s}d_k y_k = \frac{N}{n} \sum_{k \in s} y_k = N\bar{y}_s\)</span></p>
<p>where <span class="math inline">\(d_k = 1/\pi_k = N/n\)</span> (OSU) is the design weight (designvikt) and is often added as a variable to the dataset.</p>
<p>The design weight can be interpreted as how many objects a certain object from the sample shall represent. If <span class="math inline">\(N=1000, n=100\)</span>, then</p>
<p><span class="math inline">\(\pi_k = n/N = 100/1000 = 0.1\)</span></p>
<p><span class="math inline">\(d_k = N/n = 1000/100 = 10\)</span></p>
<p>For example, for a sample of 100 schools from a population of 1000 schools, each school in the sample represents 10 schools in the population.</p>
<p><span class="math inline">\(E(\hat{t}) = E(\sum_{k \in s} \frac{y_k}{\pi_k}) = E(\sum_{k \in U} I_k \frac{y_k}{\pi_k}) = \sum_{k \in U} E(I_k) \frac{y_k}{\pi_k} = \sum_{k \in U} \pi_k \frac{y_k}{\pi_k} = \sum_{k \in U} y_k = t\)</span></p>
<p>Note that:</p>
<ul>
<li><p>Indcator variable <span class="math inline">\(I_k\)</span> was added so sum over s changed to sum over U</p></li>
<li><p><span class="math inline">\(y\)</span> is regarded as a fixed constant in this type of survey sampling. The randomness is instead introduced from the sampling design. The advantage is that no assumptions are needed (in the case of full response).</p></li>
</ul>
<p>Note that the mean is estimated with</p>
<p><span class="math inline">\(\hat{\bar{y}}_U = \frac{\sum_s y_k/\pi_k}{\sum_s d_k} = \frac{\hat{t}_{HT}}{\hat{N}} = \frac{\sum_{k \in s} (N/n)y_k}{N} = \frac{1}{n} \sum_{k \in s} y_k = \bar{y}_s\)</span></p>
<p>In OSU, <span class="math inline">\(\hat{N} = \sum_s d_k = \sum_s N/n = N/n \sum_s 1 = N\)</span>.</p>
<p><span class="math inline">\(E(\hat{\bar{y}}_U) = \frac{E(\sum_s y_k/\pi_k)}{N} = \frac{\sum_U y_k}{N} = \frac{t}{N}\)</span></p>
<section id="variance-of-the-horvitz-thompson-estimator" class="level3">
<h3 class="anchored" data-anchor-id="variance-of-the-horvitz-thompson-estimator">Variance of the Horvitz-Thompson Estimator</h3>
<p><span class="math inline">\(V(\hat{t}) = \sum_{k \in U} \sum_{l \in U} (\pi_{kl} -\pi_{k}\pi_{l}) \frac{y_k}{\pi_{k}} \frac{y_l}{\pi_{l}}\)</span></p>
<p><span class="math inline">\(\pi_{k} = \frac{n}{N}\)</span></p>
<p><span class="math inline">\(\pi_{kl} = P(k\&amp;l \in s) = \frac{\binom{2}{2}{\binom{N-2}{n-2}}}{\binom{N}{n}} = \frac{n(n-1)}{N(N-1)}, k \neq l\)</span></p>
<p>Note</p>
<p><span class="math inline">\(\sum_{k \in U} \pi_{k} = N \frac{n}{N} = n\)</span></p>
<p>$<em>{k j} </em>{kl} = N = $</p>
<p>OSU:</p>
<p><span class="math inline">\(V(\hat{t}) = N^2\frac{1-\frac{n}{N}}{n} S^2_{yU}\)</span></p>
<p>where</p>
<p><span class="math display">\[
\begin{align}
S^2_{yU} &amp;= \frac{1}{N-1}\sum_{k \in U} (y_k - \bar{y}_U)^2 \\
&amp;= \frac{1}{N} (\sum_{k \in U} y^2_k - \frac{1}{N-1}\sum_{k \in U}\sum_{l \in U} y_ky_l), k \neq l
\end{align}
\]</span></p>
<p>Härledning</p>
<p><span class="math display">\[
\begin{align}
V(\hat{t}) &amp;= \sum_{k \in U} \sum_{l \in U} (\pi_{kl} -\pi_{k}\pi_{l}) \frac{y_k}{\pi_{k}} \frac{y_l}{\pi_{l}} \\
&amp;=  (\sum_{k \in U} \sum_{l \in U}\pi_{kl} - \sum_{k \in U} \sum_{l \in U}\pi_{k}\pi_{l}) \sum_{k \in U} \sum_{l \in U} \frac{y_k}{\pi_{k}} \frac{y_l}{\pi_{l}} \\
&amp;=  (\frac{n(n-1)}{(N-1)} - n^2) n^2 \sum_{k \in U} y_k \sum_{l \in U} y_l \\
&amp;= \sum_{k \in U} \sum_{l \in U} (\frac{n(n-1)}{N(N-1)} -\frac{n}{N}\frac{n}{N}) \frac{y_k}{\frac{n}{N}} \frac{y_l}{\frac{n}{N}} \\
&amp;= \sum_{k \in U} \sum_{l \in U} (\frac{N}{n}\frac{N}{n} \frac{n(n-1)}{N(N-1)} -\frac{n}{N}\frac{n}{N}\frac{N}{n}\frac{N}{n}) y_k y_l \\
&amp;= \sum_{k \in U} \sum_{l \in U} (\frac{N}{n} \frac{(n-1)}{(N-1)} - 1) y_k y_l \\
&amp;= \sum_{k \in U} \sum_{l \in U} (\frac{N}{n} \frac{(n-1)}{(N-1)} y_k y_l  - y_k y_l )
\end{align}
\]</span></p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>